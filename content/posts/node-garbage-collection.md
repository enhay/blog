---
title: "node垃圾回收"
tags: ["node"]
date: 2019-06-18
draft: true
---

### 分代回收
新生区
老生区

### 新生区-Scavenge算法
新生区和老生区
新生区:
出区和入区
分配在出区,当出区耗尽,交换出区和入区
对旧的出区进行清理

 广度优先搜索所有根对象可达的对象并标记
 移动对象和指向对象的指针
 跟踪这个对象指向的指针,如果指针在不在入区,就说明他在老区,不用管,
 如果指针指向入区,且未被标记,标记这个指针设置转发地址, 复制出区
 如果指针已经被标记(可能是根元素可达,也可能是被其它元素设置过),说明已经处理过了
 当所有的内容都处理完毕时,剩余(未被转发的)对象即为垃圾 直接把整个空间抹平就行

 引入写屏障(flag表)表示元素被老生区引用
```javascript
// 广度优先遍历交换
```


### 老生区-标记清除
 对与老生区,太大了,没法交换
 创建时老生区预留标记位图(位图) 默认所有节点颜色为白色
 从根元素开始深度扫描,
 将可达的元素设置为灰色, 如果所有可达的元素都处理过,则标记为黑色, 
 白色的数据就可以清除了

 优化 增量标记
 标记后不清除
 如果一个黑对象指向了白对象, 需要将其染成灰色, 并处理灰对象的邻接对象
 多标记 少清理
 ```javascript
 // 深度优先遍历染色
 ```